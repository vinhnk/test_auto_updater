<form nz-form [formGroup]="form" (ngSubmit)="submitForm($event)">
  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Số hành khách</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập số hành khách'">
          <nz-input-number formControlName="passengerCount" [nzMin]="1"></nz-input-number>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Ngày đi</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng chọn ngày đi'">
          <nz-date-picker formControlName="selectedDate"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Điểm đi</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập điểm đi'">
          <input nz-input formControlName="selectedDeparture" />
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Điểm đến</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập điểm đến'">
          <input nz-input formControlName="selectedDestination" />
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Giờ đi</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập giờ đi (HH:mm)'">
          <input nz-input type="time" formControlName="departureTime" [step]="60" format="HH:mm" />
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Giờ đến</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập giờ đến (HH:mm)'">
          <input nz-input type="time" formControlName="arrivalTime" />
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Giá vé</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập giá vé'">
          <nz-input-number formControlName="price" [nzMin]="0" [nzStep]="1000"></nz-input-number>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Giá gốc</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập giá gốc'">
          <nz-input-number formControlName="originalPrice" [nzMin]="0" [nzStep]="1000"></nz-input-number>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Điểm xuất phát</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập điểm xuất phát'">
          <input nz-input formControlName="departurePoint" />
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Điểm cuối</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập điểm cuối'">
          <input nz-input formControlName="destinationPoint" />
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Giảm giá</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <nz-switch formControlName="hasDiscount"></nz-switch>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Trạng thái</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <nz-select formControlName="status">
            <nz-option [nzValue]="0" nzLabel="Chờ xác nhận"></nz-option>
            <nz-option [nzValue]="1" nzLabel="Đã xác nhận"></nz-option>
            <nz-option [nzValue]="2" nzLabel="Đã hủy"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Tiền cọc</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập số tiền cọc'">
          <nz-input-number formControlName="payAdvance" [nzMin]="0" [nzStep]="1000"></nz-input-number>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Phương thức thanh toán</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng chọn phương thức thanh toán'">
          <nz-select formControlName="payType">
            <nz-option nzValue="awardpoint" nzLabel="Điểm thưởng"></nz-option>
            <nz-option nzValue="qrcode" nzLabel="QR Code"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>

    <div nz-col [nzSpan]="8">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" [nzRequired]="true">Người tạo</nz-form-label>
        <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập người tạo'">
          <input nz-input formControlName="createdBy" />
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="24">
      <nz-form-item>
        <nz-form-label [nzSpan]="24">Ghi chú</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <textarea nz-input formControlName="note" [nzAutosize]="{ minRows: 3, maxRows: 5 }"></textarea>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  
  <nz-divider></nz-divider>

  <div class="passengers-section">
    <h3>Danh sách hành khách</h3>
    <div formArrayName="passengers">
      <div
        *ngFor="let passenger of passengers.controls; let i = index"
        [formGroupName]="i"
        class="passenger-form"
      >
        <h4>Hành khách {{ i + 1 }}</h4>

        <div nz-row [nzGutter]="24">
          <div nz-col [nzSpan]="8">
            <nz-form-item>
              <nz-form-label [nzSpan]="24" [nzRequired]="true">Họ tên</nz-form-label>
              <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập họ tên'">
                <input nz-input formControlName="fullName" />
              </nz-form-control>
            </nz-form-item>
          </div>

          <div nz-col [nzSpan]="8">
            <nz-form-item>
              <nz-form-label [nzSpan]="24" [nzRequired]="true">Năm sinh</nz-form-label>
              <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập năm sinh (4 số)'">
                <input nz-input formControlName="birthYear" />
              </nz-form-control>
            </nz-form-item>
          </div>

          <div nz-col [nzSpan]="8">
            <nz-form-item>
              <nz-form-label [nzSpan]="24" [nzRequired]="true">Số điện thoại</nz-form-label>
              <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập số điện thoại (10-11 số)'">
                <input nz-input formControlName="phoneNumber" />
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div nz-row [nzGutter]="24">
          <div nz-col [nzSpan]="12">
            <nz-form-item>
              <nz-form-label [nzSpan]="24" [nzRequired]="true">Điểm đón</nz-form-label>
              <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập điểm đón'">
                <input nz-input formControlName="pickupPoint" />
              </nz-form-control>
            </nz-form-item>
          </div>

          <div nz-col [nzSpan]="12">
            <nz-form-item>
              <nz-form-label [nzSpan]="24" [nzRequired]="true">Điểm trả</nz-form-label>
              <nz-form-control [nzSpan]="24" [nzErrorTip]="'Vui lòng nhập điểm trả'">
                <input nz-input formControlName="dropoffPoint" />
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="24" class="text-right" *ngIf="showSaveButton">
      <button
        nz-button
        nzType="primary"
        [nzLoading]="loading"
        (click)="handleSave()"
      >
        Lưu thay đổi
      </button>
    </div>
  </div>
</form>
